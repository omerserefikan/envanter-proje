<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>BT Envanter - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .card-stats { border: none; border-radius: 15px; transition: transform 0.3s; }
        .card-stats:hover { transform: translateY(-5px); }
        .icon-box { font-size: 2rem; opacity: 0.3; position: absolute; right: 15px; top: 15px; }
    </style>
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4 shadow">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/">BT ENVANTER</a>
            <div class="navbar-nav">
                <a class="nav-link active" href="/">Dashboard</a>
                <a class="nav-link" href="/envanter">Envanter Yönetimi</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card card-stats bg-primary text-white shadow">
                    <div class="card-body">
                        <h6 class="text-uppercase small">Toplam Envanter</h6>
                        <h2 class="display-6 fw-bold"><%= toplam %></h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-stats bg-success text-white shadow">
                    <div class="card-body">
                        <h6 class="text-uppercase small">Aktif Kullanımda</h6>
                        <h2 class="display-6 fw-bold"><%= kullanımda %></h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card card-stats bg-danger text-white shadow">
                    <div class="card-body">
                        <h6 class="text-uppercase small">Arızalı / Bakımda</h6>
                        <h2 class="display-6 fw-bold"><%= arizali %></h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-5">
                <div class="card shadow border-0 mb-4">
                    <div class="card-header bg-white fw-bold">Durum Dağılımı</div>
                    <div class="card-body">
                        <canvas id="myPieChart" style="height: 300px;"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-md-7">
                <div class="card shadow border-0 mb-4">
                    <div class="card-header bg-white fw-bold d-flex justify-content-between align-items-center">
                        Son Eklenen Cihazlar
                        <a href="/envanter" class="btn btn-sm btn-outline-primary">Tümünü Gör</a>
                    </div>
                    <div class="card-body p-0">
                        <table class="table table-sm table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-3">Cihaz</th>
                                    <th>Durum</th>
                                    <th>Kişi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% sonEklenenler.forEach(cihaz => { %>
                                    <tr>
                                        <td class="ps-3"><%= cihaz.cihaz_adi %></td>
                                        <td><span class="badge rounded-pill <%= cihaz.durum === 'Arızalı' ? 'bg-danger' : 'bg-primary' %>"><%= cihaz.durum %></span></td>
                                        <td><%= cihaz.zimmetli_kisi || '---' %></td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const statsData = JSON.parse('<%- JSON.stringify(istatistikler) %>');
        const ctx = document.getElementById('myPieChart').getContext('2d');
        new Chart(ctx, {
            type: 'doughnut', 
            data: {
                labels: statsData.map(i => i.durum),
                datasets: [{
                    data: statsData.map(i => i.sayi),
                    backgroundColor: ['#0d6efd', '#198754', '#ffc107', '#dc3545']
                }]
            },
            options: { cutout: '70%', plugins: { legend: { position: 'bottom' } } }
        });
    </script>
</body>
</html>